{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nvar _jsxFileName = \"G:\\\\codes\\\\tabNavigation\\\\screens\\\\BookTransactionScreen.js\";\nimport React from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport ToastAndroid from \"react-native-web/dist/exports/ToastAndroid\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport * as Permissions from 'expo-permissions';\nimport { BarCodeScanner } from 'expo-barcode-scanner';\nimport * as firebase from 'firebase';\nimport db from \"../config.js\";\n\nvar TransactionScreen = function (_React$Component) {\n  _inherits(TransactionScreen, _React$Component);\n\n  function TransactionScreen() {\n    var _this;\n\n    _classCallCheck(this, TransactionScreen);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TransactionScreen).call(this));\n\n    _this.getCameraPermissions = function _callee(id) {\n      var _await$Permissions$as, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA));\n\n            case 2:\n              _await$Permissions$as = _context.sent;\n              status = _await$Permissions$as.status;\n\n              _this.setState({\n                hasCameraPermissions: status === \"granted\",\n                buttonState: id,\n                scanned: false\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n\n    _this.handleBarCodeScanned = function _callee2(_ref) {\n      var type, data, buttonState;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              type = _ref.type, data = _ref.data;\n              buttonState = _this.state.buttonState;\n\n              if (buttonState === \"BookId\") {\n                _this.setState({\n                  scanned: true,\n                  scannedBookId: data,\n                  buttonState: 'normal'\n                });\n              } else if (buttonState === \"StudentId\") {\n                _this.setState({\n                  scanned: true,\n                  scannedStudentId: data,\n                  buttonState: 'normal'\n                });\n              }\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    };\n\n    _this.initiateBookIssue = function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              db.collection(\"transactions\").add({\n                'studentId': _this.state.scannedStudentId,\n                'bookId': _this.state.scannedBookId,\n                'date': firebase.firestore.Timestamp.now().toDate(),\n                'transactionType': \"Issue\"\n              });\n              db.collection(\"books\").doc(_this.state.scannedBookId).update({\n                'bookAvailability': false\n              });\n              db.collection(\"students\").doc(_this.state.scannedStudentId).update({\n                'numberOfBooksIssued': firebase.firestore.FieldValue.increment(1)\n              });\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      });\n    };\n\n    _this.initiateBookReturn = function _callee4() {\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              db.collection(\"transactions\").add({\n                'studentId': _this.state.scannedStudentId,\n                'bookId': _this.state.scannedBookId,\n                'date': firebase.firestore.Timestamp.now().toDate(),\n                'transactionType': \"Return\"\n              });\n              db.collection(\"books\").doc(_this.state.scannedBookId).update({\n                'bookAvailability': true\n              });\n              db.collection(\"students\").doc(_this.state.scannedStudentId).update({\n                'numberOfBooksIssued': firebase.firestore.FieldValue.increment(-1)\n              });\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      });\n    };\n\n    _this.handleTransaction = function _callee5() {\n      var transactionMessage;\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              db.collection(\"books\").doc(_this.state.scannedBookId).get().then(function (doc) {\n                var book = doc.data();\n\n                if (book.bookAvailability) {\n                  _this.initiateBookIssue();\n\n                  transactionMessage = \"Book Issued\";\n                  ToastAndroid.show(transactionMessage, ToastAndroid.SHORT);\n                } else {\n                  _this.initiateBookReturn();\n\n                  transactionMessage = \"Book Returned\";\n                  ToastAndroid.show(transactionMessage, ToastAndroid.SHORT);\n                }\n              });\n\n              _this.setState({\n                transactionMessage: transactionMessage\n              });\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      });\n    };\n\n    _this.state = {\n      hasCameraPermissions: null,\n      scanned: false,\n      scannedBookId: '',\n      scannedStudentId: '',\n      buttonState: 'normal',\n      transactionMessage: ''\n    };\n    return _this;\n  }\n\n  _createClass(TransactionScreen, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var hasCameraPermissions = this.state.hasCameraPermissions;\n      var scanned = this.state.scanned;\n      var buttonState = this.state.buttonState;\n\n      if (buttonState !== \"normal\" && hasCameraPermissions) {\n        return React.createElement(BarCodeScanner, {\n          onBarCodeScanned: scanned ? undefined : this.handleBarCodeScanned,\n          style: StyleSheet.absoluteFillObject,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 130\n          }\n        });\n      } else if (buttonState === \"normal\") {\n        return React.createElement(KeyboardAvoidingView, {\n          style: styles.container,\n          behavior: \"padding\",\n          enabled: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 139\n          }\n        }, React.createElement(View, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          }\n        }, React.createElement(Image, {\n          source: require(\"../assets/booklogo.jpg\"),\n          style: {\n            width: 200,\n            height: 200\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          }\n        }), React.createElement(Text, {\n          style: {\n            textAlign: 'center',\n            fontSize: 30\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          }\n        }, \"Wily\")), React.createElement(View, {\n          style: styles.inputView,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146\n          }\n        }, React.createElement(TextInput, {\n          style: styles.inputBox,\n          placeholder: \"Book Id\",\n          onChangeText: function onChangeText(text) {\n            return _this2.setState({\n              scannedBookId: text\n            });\n          },\n          value: this.state.scannedBookId,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          }\n        }), React.createElement(TouchableOpacity, {\n          style: styles.scanButton,\n          onPress: function onPress() {\n            _this2.getCameraPermissions(\"BookId\");\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          }\n        }, React.createElement(Text, {\n          style: styles.buttonText,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157\n          }\n        }, \"Scan\"))), React.createElement(View, {\n          style: styles.inputView,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          }\n        }, React.createElement(TextInput, {\n          style: styles.inputBox,\n          placeholder: \"Student Id\",\n          onChangeText: function onChangeText(text) {\n            return _this2.setState({\n              scannedStudentId: text\n            });\n          },\n          value: this.state.scannedStudentId,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          }\n        }), React.createElement(TouchableOpacity, {\n          style: styles.scanButton,\n          onPress: function onPress() {\n            _this2.getCameraPermissions(\"StudentId\");\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 167\n          }\n        }, React.createElement(Text, {\n          style: styles.buttonText,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          }\n        }, \"Scan\"))), React.createElement(TouchableOpacity, {\n          style: styles.submitButton,\n          onPress: function _callee6() {\n            var transactionMessage;\n            return _regeneratorRuntime.async(function _callee6$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    transactionMessage = _this2.handleTransaction();\n\n                    _this2.setState({\n                      scannedBookId: '',\n                      scannedStudentId: ''\n                    });\n\n                  case 2:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          }\n        }, React.createElement(Text, {\n          style: styles.submitButtonText,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 183\n          }\n        }, \"Submit\")));\n      }\n    }\n  }]);\n\n  return TransactionScreen;\n}(React.Component);\n\nexport { TransactionScreen as default };\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  displayText: {\n    fontSize: 15,\n    textDecorationLine: 'underline'\n  },\n  scanButton: {\n    backgroundColor: '#2196F3',\n    padding: 10,\n    margin: 10\n  },\n  buttonText: {\n    fontSize: 15,\n    textAlign: 'center',\n    marginTop: 10\n  },\n  inputView: {\n    flexDirection: 'row',\n    margin: 20\n  },\n  inputBox: {\n    width: 200,\n    height: 40,\n    borderWidth: 1.5,\n    borderRightWidth: 0,\n    fontSize: 20\n  },\n  scanButton: {\n    backgroundColor: '#66BB6A',\n    width: 50,\n    borderWidth: 1.5,\n    borderLeftWidth: 0\n  },\n  submitButton: {\n    backgroundColor: '#FBC02D',\n    width: 100,\n    height: 50\n  },\n  submitButtonText: {\n    padding: 10,\n    textAlign: 'center',\n    fontSize: 20,\n    fontWeight: \"bold\",\n    color: 'white'\n  }\n});","map":{"version":3,"sources":["G:/codes/tabNavigation/screens/BookTransactionScreen.js"],"names":["React","Permissions","BarCodeScanner","firebase","db","TransactionScreen","getCameraPermissions","id","askAsync","CAMERA","status","setState","hasCameraPermissions","buttonState","scanned","handleBarCodeScanned","type","data","state","scannedBookId","scannedStudentId","initiateBookIssue","collection","add","firestore","Timestamp","now","toDate","doc","update","FieldValue","increment","initiateBookReturn","handleTransaction","get","then","book","bookAvailability","transactionMessage","ToastAndroid","show","SHORT","undefined","StyleSheet","absoluteFillObject","styles","container","require","width","height","textAlign","fontSize","inputView","inputBox","text","scanButton","buttonText","submitButton","submitButtonText","Component","create","flex","justifyContent","alignItems","displayText","textDecorationLine","backgroundColor","padding","margin","marginTop","flexDirection","borderWidth","borderRightWidth","borderLeftWidth","fontWeight","color"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Text,\r\n View,\r\n TouchableOpacity,\r\n TextInput,\r\n Image,\r\n StyleSheet,\r\n KeyboardAvoidingView ,\r\nToastAndroid,Alert} from 'react-native';\r\nimport * as Permissions from 'expo-permissions';\r\nimport { BarCodeScanner } from 'expo-barcode-scanner';\r\nimport * as firebase from 'firebase'\r\nimport db from '../config.js'\r\n\r\nexport default class TransactionScreen extends React.Component {\r\n constructor(){\r\n super();\r\n this.state = {\r\n hasCameraPermissions: null,\r\n scanned: false,\r\n scannedBookId: '',\r\n scannedStudentId:'',\r\n buttonState: 'normal',\r\n transactionMessage: ''\r\n }\r\n }\r\n\r\n getCameraPermissions = async (id) =>{\r\n const {status} = await Permissions.askAsync(Permissions.CAMERA);\r\n \r\n this.setState({\r\n /*status === \"granted\" is true when user has granted permission\r\n status === \"granted\" is false when user has not granted the permission\r\n */\r\n hasCameraPermissions: status === \"granted\",\r\n buttonState: id,\r\n scanned: false\r\n });\r\n }\r\n\r\n handleBarCodeScanned = async({type, data})=>{\r\n const {buttonState} = this.state\r\n\r\n if(buttonState===\"BookId\"){\r\n this.setState({\r\n scanned: true,\r\n scannedBookId: data,\r\n buttonState: 'normal'\r\n });\r\n }\r\n else if(buttonState===\"StudentId\"){\r\n this.setState({\r\n scanned: true,\r\n scannedStudentId: data,\r\n buttonState: 'normal'\r\n });\r\n }\r\n \r\n }\r\n\r\n initiateBookIssue = async()=>{\r\n //add a transaction\r\n db.collection(\"transactions\").add({\r\n 'studentId': this.state.scannedStudentId,\r\n 'bookId' : this.state.scannedBookId,\r\n 'date' : firebase.firestore.Timestamp.now().toDate(),\r\n 'transactionType': \"Issue\"\r\n })\r\n //change book status\r\n db.collection(\"books\").doc(this.state.scannedBookId).update({\r\n 'bookAvailability': false\r\n })\r\n //change number of issued books for student\r\n db.collection(\"students\").doc(this.state.scannedStudentId).update({\r\n 'numberOfBooksIssued': firebase.firestore.FieldValue.increment(1)\r\n })\r\n }\r\n\r\n initiateBookReturn = async()=>{\r\n //add a transaction\r\n db.collection(\"transactions\").add({\r\n 'studentId': this.state.scannedStudentId,\r\n 'bookId' : this.state.scannedBookId,\r\n 'date' : firebase.firestore.Timestamp.now().toDate(),\r\n 'transactionType': \"Return\"\r\n })\r\n //change book status\r\n db.collection(\"books\").doc(this.state.scannedBookId).update({\r\n 'bookAvailability': true\r\n })\r\n //change number of issued books for student\r\n db.collection(\"students\").doc(this.state.scannedStudentId).update({\r\n 'numberOfBooksIssued': firebase.firestore.FieldValue.increment(-1)\r\n })\r\n }\r\n\r\n\r\n handleTransaction = async()=>{\r\n var transactionMessage\r\n db.collection(\"books\").doc(this.state.scannedBookId).get()\r\n .then((doc)=>{\r\n //snapshot.forEach((doc)=>{\r\n var book = doc.data()\r\n if(book.bookAvailability){\r\n this.initiateBookIssue(); \r\n transactionMessage = \"Book Issued\"\r\n ToastAndroid.show(transactionMessage, ToastAndroid.SHORT);\r\n // Alert.alert(transactionMessage)\r\n }\r\n else{\r\n this.initiateBookReturn();\r\n transactionMessage = \"Book Returned\"\r\n ToastAndroid.show(transactionMessage, ToastAndroid.SHORT);\r\n // Alert.alert(transactionMessage)\r\n }\r\n })\r\n\r\n this.setState({\r\n transactionMessage: transactionMessage\r\n })\r\n }\r\n\r\n render() {\r\n const hasCameraPermissions = this.state.hasCameraPermissions;\r\n const scanned = this.state.scanned;\r\n const buttonState = this.state.buttonState;\r\n\r\n if (buttonState !== \"normal\" && hasCameraPermissions){\r\n return(\r\n <BarCodeScanner\r\n onBarCodeScanned={scanned ? undefined : this.handleBarCodeScanned}\r\n style={StyleSheet.absoluteFillObject}\r\n />\r\n );\r\n }\r\n\r\n else if (buttonState === \"normal\"){\r\n return(\r\n <KeyboardAvoidingView style={styles.container} behavior=\"padding\" enabled>\r\n <View>\r\n <Image\r\n source={require(\"../assets/booklogo.jpg\")}\r\n style={{width:200, height: 200}}/>\r\n <Text style={{textAlign: 'center', fontSize: 30}}>Wily</Text>\r\n </View>\r\n <View style={styles.inputView}>\r\n <TextInput \r\n style={styles.inputBox}\r\n placeholder=\"Book Id\"\r\n onChangeText={text =>this.setState({scannedBookId:text})}\r\n value={this.state.scannedBookId}/>\r\n <TouchableOpacity \r\n style={styles.scanButton}\r\n onPress={()=>{\r\n this.getCameraPermissions(\"BookId\")\r\n }}>\r\n <Text style={styles.buttonText}>Scan</Text>\r\n </TouchableOpacity>\r\n </View>\r\n\r\n <View style={styles.inputView}>\r\n <TextInput \r\n style={styles.inputBox}\r\n placeholder=\"Student Id\"\r\n onChangeText ={text => this.setState({scannedStudentId:text})}\r\n value={this.state.scannedStudentId}/>\r\n <TouchableOpacity \r\n style={styles.scanButton}\r\n onPress={()=>{\r\n this.getCameraPermissions(\"StudentId\")\r\n }}>\r\n <Text style={styles.buttonText}>Scan</Text>\r\n </TouchableOpacity>\r\n </View>\r\n <TouchableOpacity\r\n style={styles.submitButton}\r\n onPress={async()=>{\r\n var transactionMessage = this.handleTransaction();\r\n this.setState(\r\n {scannedBookId:'',\r\n scannedStudentId:''})\r\n }}>\r\n <Text style={styles.submitButtonText}>Submit</Text>\r\n </TouchableOpacity>\r\n </KeyboardAvoidingView>\r\n );\r\n }\r\n }\r\n }\r\n\r\n const styles = StyleSheet.create({\r\n container: {\r\n flex: 1,\r\n justifyContent: 'center',\r\n alignItems: 'center'\r\n },\r\n displayText:{\r\n fontSize: 15,\r\n textDecorationLine: 'underline'\r\n },\r\n scanButton:{\r\n backgroundColor: '#2196F3',\r\n padding: 10,\r\n margin: 10\r\n },\r\n buttonText:{\r\n fontSize: 15,\r\n textAlign: 'center',\r\n marginTop: 10\r\n },\r\n inputView:{\r\n flexDirection: 'row',\r\n margin: 20\r\n },\r\n inputBox:{\r\n width: 200,\r\n height: 40,\r\n borderWidth: 1.5,\r\n borderRightWidth: 0,\r\n fontSize: 20\r\n },\r\n scanButton:{\r\n backgroundColor: '#66BB6A',\r\n width: 50,\r\n borderWidth: 1.5,\r\n borderLeftWidth: 0\r\n },\r\n submitButton:{\r\n backgroundColor: '#FBC02D',\r\n width: 100,\r\n height:50\r\n },\r\n submitButtonText:{\r\n padding: 10,\r\n textAlign: 'center',\r\n fontSize: 20,\r\n fontWeight:\"bold\",\r\n color: 'white'\r\n }\r\n });"]},"metadata":{},"sourceType":"module"}